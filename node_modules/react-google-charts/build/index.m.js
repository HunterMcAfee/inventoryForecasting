import{Component as t,createElement as o}from"react";var e=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],a=Object.freeze({DEFAULT_CHART_COLORS:e,default:e}),r=function(t){if(void 0===t&&(t=window),void 0===t)return{};if(void 0===t.google)throw new Error("google not in window object. Error in get-google-charts.");return t.google},n=new function(){var t=this;this.isLoaded=!1,this.isLoading=!1,this.loadScript=null,this.destroy=function(){t.isLoading=!1,t.isLoaded=!1,t.loadScript=null},this.init=function(o,e,a,r){if((t.isLoading||t.isLoaded)&&null!==t.loadScript)return t.loadScript;t.isLoading=!0;var n="undefined"!=typeof window?require("loadjs"):function(t,o){return(0,o.success)()};return t.loadScript=new Promise(function(i){n("https://www.gstatic.com/charts/loader.js",{success:function(){var n=function(t){if(void 0===t&&(t=window),void 0===t)return{};if(void 0===t.google)throw new Error("google not in window object. Error in get-google-charts.");return t.google.charts}(window);n.load(e||"current",{packages:o||["corechart"],language:a||"en",mapsApiKey:r}),n.setOnLoadCallback(function(){t.isLoaded=!0,t.isLoading=!1,i()})}})}),t.isLoading=!0,t.loadScript}},i=0,s=function(){return"reactgooglegraph-"+(i+=1)},l=function(t){function e(o){var e=this;t.call(this,o),this.chart=null,this.wrapper=null,this.hidden_columns={},this.dataTable=[],this.isUnmounted=!1,this.onResize=function(){e.drawChart()},this.onSelectToggle=function(){if(null!==e.chart&&e.props.legend_toggle){var t=e.chart.getSelection();if(t.length>0)if(null==t[0].row)e.togglePoints(t[0].column)}},this.getColumnColor=function(t){if(e.props.options&&e.props.options.colors){if(e.props.options.colors[t])return e.props.options.colors[t]}else if(t in a)return a[t];return a[0]},this.applyNumberFormat=function(t,o){new(r(window).visualization.NumberFormat)(o).format(e.dataTable,t)},this.applyDateFormat=function(t,o){new(r(window).visualization.DateFormat)(o).format(e.dataTable,t)},this.buildDataTableFromProps=function(){var t=e.props.chartType,o=r(window);if(e.props.diffdata&&null!==e.props.chartType){var a=e.props.diffdata,n=o.visualization.arrayToDataTable(a.old),i=o.visualization.arrayToDataTable(a.new);return(0,o.visualization[t].prototype.computeDiff)(n,i)}if(null===e.props.data&&e.props.rows&&0===e.props.rows.length&&!1==!e.props.allowEmptyRows)throw new Error("Can't build DataTable from rows and columns: rows array in props is empty");if(null===e.props.data&&e.props.columns&&0===e.props.columns.length)throw new Error("Can't build DataTable from rows and columns: columns array in props is empty");if(null!==e.props.data)try{return e.wrapper.setDataTable(e.props.data),e.wrapper.getDataTable()}catch(t){throw new Error("Failed to set DataTable from data props ! ",t)}var s=new window.google.visualization.DataTable;if(e.props.columns.forEach(function(t){s.addColumn(t)}),s.addRows(e.props.rows),e.props.numberFormat){var l=e.props.numberFormat;e.applyNumberFormat(l.column,l.options)}if(e.props.dateFormat){var p=e.props.dateFormat,d=p.options;p.columns.forEach(function(t){e.applyDateFormat(t,d)})}return e.props.formatters.forEach(function(t){var o=t.type,a=t.column,r=t.options;switch(o){case"NumberFormat":e.applyNumberFormat(a,r);break;case"DateFormat":e.applyDateFormat(a,r);break;default:console.log("Unkown formatter type: "+o)}}),s},this.updateDataTable=function(){return window.google.visualization.errors.removeAll(document.getElementById(e.wrapper.getContainerId())),e.dataTable.removeRows(0,e.dataTable.getNumberOfRows()),e.dataTable.removeColumns(0,e.dataTable.getNumberOfColumns()),e.dataTable=e.buildDataTableFromProps(),e.dataTable},this.drawChart=function(){if(!e.isUnmounted){if(e.wrapper){if(e.updateDataTable(),e.wrapper.setDataTable(e.dataTable),e.wrapper.setOptions(e.props.options),e.wrapper.getChartType()!==e.props.chartType){window.google.visualization.events.removeAllListeners(e.wrapper),e.wrapper.setChartType(e.props.chartType);var t=e;window.google.visualization.events.addOneTimeListener(e.wrapper,"ready",function(){t.chart=t.wrapper.getChart(),t.listenToChartEvents.call(t)})}}else e.wrapper=new window.google.visualization.ChartWrapper({chartType:e.props.chartType,options:e.props.options,containerId:e.state.graphID}),e.dataTable=e.buildDataTableFromProps(),e.wrapper.setDataTable(e.dataTable),window.google.visualization.events.addOneTimeListener(e.wrapper,"ready",function(){e.chart=e.wrapper.getChart(),e.listenToChartEvents(),e.addChartActions()});e.wrapper.draw()}},this.addChartActions=function(){null!==e.props.chartActions&&e.props.chartActions.forEach(function(t){e.chart.setAction({id:t.id,text:t.text,action:t.action.bind(e,e.chart)})})},this.listenToChartEvents=function(){e.props.legend_toggle&&window.google.visualization.events.addListener(e.wrapper,"select",e.onSelectToggle),e.props.chartEvents.forEach(function(t){var o;"ready"===t.eventName?t.callback(e):(o=t,window.google.visualization.events.addListener(e.chart,o.eventName,function(t){o.callback(e,t)}))})},this.buildColumnFromSourceData=function(t){return{label:e.dataTable.getColumnLabel(t),type:e.dataTable.getColumnType(t),sourceColumn:t,role:e.dataTable.getColumnRole(t)}},this.buildEmptyColumnFromSourceData=function(t){return{label:e.dataTable.getColumnLabel(t),type:e.dataTable.getColumnType(t),calc:function(){return null},role:e.dataTable.getColumnRole(t)}},this.addEmptyColumnTo=function(t,o){var a=e.buildEmptyColumnFromSourceData(o);t.push(a)},this.hideColumn=function(t,o){e.isHidden(o)||(e.hidden_columns[o]={color:e.getColumnColor(o-1)}),t.push("#CCCCCC")},this.addSourceColumnTo=function(t,o){var a=e.buildColumnFromSourceData(o);t.push(a)},this.isHidden=function(t){return void 0!==e.hidden_columns[t]},this.restoreColorTo=function(t,o){var a;e.isHidden(o)?(a=e.hidden_columns[o].color,delete e.hidden_columns[o]):a=e.getColumnColor(o-1),0!==o&&t.push(a)},this.debounce=function(t,o){var e;return function(){for(var a=[],r=arguments.length;r--;)a[r]=arguments[r];var n=this;clearTimeout(e),e=setTimeout(function(){return t.apply(n,a)},o)}},this.togglePoints=function(t){for(var o=new window.google.visualization.DataView(e.wrapper.getDataTable()),a=o.getNumberOfColumns(),r=[],n=[],i=0;i<a;i+=1)0===i?e.addSourceColumnTo(n,i):i===t?e.isHidden(i)?(e.addSourceColumnTo(n,i),e.restoreColorTo(r,i)):(e.addEmptyColumnTo(n,i),e.hideColumn(r,i)):e.isHidden(i)?(e.addEmptyColumnTo(n,i),e.hideColumn(r,i)):(e.addSourceColumnTo(n,i),e.restoreColorTo(r,i));o.setColumns(n),e.props.options.colors=r,e.chart.draw(o,e.props.options)},this.state={graphID:o.graph_id||s()}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidMount=function(){var t=this;"undefined"!=typeof window&&(this.props.loadCharts?n.init(this.props.chartPackages,this.props.chartVersion,this.props.chartLanguage,this.props.mapsApiKey).then(function(){t.drawChart(),t.onResize=t.debounce(t.onResize,200),window.addEventListener("resize",t.onResize)}):this.drawChart())},e.prototype.componentDidUpdate=function(){var t=this;this.props.loadCharts?n.isLoading?n.loadScript&&n.loadScript.then(function(){t.drawChart()}):n.isLoaded&&this.drawChart():this.drawChart()},e.prototype.componentWillUnmount=function(){this.isUnmounted=!0,n.destroy();try{window&&(window.google&&window.google.visualization&&window.google.visualization.events.removeAllListeners(this.wrapper),window.removeEventListener("resize",this.onResize))}catch(t){return}},e.prototype.render=function(){return o("div",{id:this.state.graphID,style:{height:this.props.height||this.props.options.height,width:this.props.width||this.props.options.width}},this.props.loader?this.props.loader:"Rendering Chart...")},e}(t);l.defaultProps={chartType:"LineChart",rows:[],columns:[],options:{chart:{title:"Chart Title",subtitle:"Subtitle"},hAxis:{title:"X Label"},vAxis:{title:"Y Label"},width:"100%",height:"100%"},width:"400px",height:"300px",chartEvents:[],chartActions:null,data:null,legend_toggle:!1,allowEmptyRows:!1,loadCharts:!0,loader:o("div",null,"Rendering Chart"),chartPackages:["corechart"],chartVersion:"current",chartLanguage:"en",numberFormat:null,dateFormat:null,formatters:[],diffdata:null};export default{Chart:l};export{l as Chart};
//# sourceMappingURL=index.m.js.map
